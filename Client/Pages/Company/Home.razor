@page "/"
@inject ICustomSnackbarProvider Snackbar
@inject IStringLocalizer<Resource> Localizer
@inject BIMatchService MatchService
@inject NavigationManager NavigationManager

<LanguageTrackProvider OnInitializeEvent="provider => provider.RegisterComponent(this)" />
<PageTitle>@Resource.CompanyName</PageTitle>

<section class="mb-4">
    <MudCarousel Class="mud-width-75 mx-auto rounded-xl overflow-hidden" Style="height:500px;" ShowArrows="true" ShowBullets="true" EnableSwipeGesture="true" AutoCycle="true" TData="object">
        <BulletTemplate Context="selected">
            <div Class="mud-button-root mud-icon-button mud-ripple mud-ripple-icon">
                <span class="mud-icon-button-label">
                    <MudIcon Class="mud-ripple mud-ripple-icon mud-icon-button-size-medium" Icon="@(selected ? Icons.Material.Filled.Circle : Icons.Material.Outlined.Circle)" />
                </span>
            </div>
        </BulletTemplate>
        <PreviousButtonTemplate>
            <div Class="mud-button-root mud-icon-button mud-ripple mud-ripple-icon">
                <span class="mud-icon-button-label">
                    <MudIcon Class="mud-ripple mud-ripple-icon mud-icon-button-size-medium" Icon="@Icons.Material.Rounded.ArrowBackIos" />
                </span>
            </div>
        </PreviousButtonTemplate>
        <NextButtonTemplate>
            <div Class="mud-button-root mud-icon-button mud-ripple mud-ripple-icon">
                <span class="mud-icon-button-label">
                    <MudIcon Class="mud-ripple mud-ripple-icon mud-icon-button-size-medium" Icon="@Icons.Material.Rounded.ArrowForwardIos" />
                </span>
            </div>
        </NextButtonTemplate>

        <ChildContent>
            <MudCarouselItem Transition="Transition.Fade" Color="@Color.Primary">
                <div class="position-relative d-flex w-100" style="height:100%;">
                    <MudImage Src="Imgs/1.jpg" Class="mx-auto my-auto" Style="width:100%; height:100%; object-fit:cover;" />
                    <div class="overlay position-absolute w-100 h-100" style="background-color: rgba(59, 86, 117, 0.6);"></div>
                    <div class="text-overlay position-absolute text-white text-center w-100" style="top:50%; transform:translateY(-50%);">
                        <h3>Your Text Here</h3>
                    </div>
                </div>
            </MudCarouselItem>
            <MudCarouselItem Transition="Transition.Fade" Color="@Color.Primary">
                <div class="position-relative d-flex w-100" style="height:100%;">
                    <MudImage Src="Imgs/2.jpg" Class="mx-auto my-auto" Style="width:100%; height:100%; object-fit:cover;" />
                    <div class="overlay position-absolute w-100 h-100" style="background-color: rgba(59, 86, 117, 0.6);"></div>
                    <div class="text-overlay position-absolute text-white text-center w-100" style="top:50%; transform:translateY(-50%);">
                        <h3>Your Text Here</h3>
                    </div>
                </div>
            </MudCarouselItem>
            <MudCarouselItem Transition="Transition.Fade" Color="@Color.Primary">
                <div class="position-relative d-flex w-100" style="height:100%;">
                    <MudImage Src="Imgs/3.jpg" Class="mx-auto my-auto" Style="width:100%; height:100%; object-fit:cover;" />
                    <div class="overlay position-absolute w-100 h-100" style="background-color: rgba(59, 86, 117, 0.6);"></div>
                    <div class="text-overlay position-absolute text-white text-center w-100" style="top:50%; transform:translateY(-50%);">
                        <h3>Your Text Here</h3>
                    </div>
                </div>
            </MudCarouselItem>
        </ChildContent>
    </MudCarousel>
</section>

<div class="event-section">
    <div class="section-header">
        <h2 class="section-title">المباريات القادمة</h2>
        <a href="#" class="view-all-link">عرض الكل</a>
    </div>

    <div class="events-container">
        <!-- Event Card 1 -->
        <div class="event-card">
            <div class="event-image-container">
                <img src="Imgs/compitation.jpeg" alt="Match 1">
                <img src="Imgs/compitation.jpeg" class="corner-logo" alt="Logo">
            </div>
            <div class="event-details">
                <h3>ملعب الامير محمد بن فهد</h3>
                <p>1 / 8 / 2024</p>
                <a href="#" class="event-button">اضغط هنا</a>
            </div>
        </div>

        <!-- Event Card 2 -->
        <div class="event-card">
            <div class="event-image-container">
                <img src="Imgs/compitation.jpeg" class="corner-logo" alt="Logo">
            </div>
            <div class="event-details">
                <h3>ملعب جامعة الملك سعود</h3>
                <p>1 / 8 / 2024</p>
                <a href="#" class="event-button">اضغط هنا</a>
            </div>
        </div>

        <!-- Event Card 3 -->
        <div class="event-card">
            <div class="event-image-container">
                <img src="Imgs/compitation.jpeg" class="corner-logo" alt="Logo">
            </div>
            <div class="event-details">
                <h3>ملعب الأمير عبد العزيز بن مساعد</h3>
                <p>1 / 8 / 2024</p>
                <a href="#" class="event-button">اضغط هنا</a>
            </div>
        </div>

        <!-- Event Card 4 -->
        <div class="event-card">
            <div class="event-image-container">
                <img src="Imgs/compitation.jpeg" class="corner-logo" alt="Logo">
            </div>
            <div class="event-details">
                <h3>ملعب مدينة الملك فهد الرياضية</h3>
                <p>1 / 8 / 2024</p>
                <a href="#" class="event-button">اضغط هنا</a>
            </div>
        </div>
    </div>
</div>



<!---Statistics Section-->
<section class="stats-section">
    <h1>دع الارقام تتكلم</h1>
    <p>أكبر شبكة حجز تذاكر في المملكة</p>

    <div class="stats-container">
        <div class="stat-box">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            <img src="customer-icon.png" alt="Customer Icon">
            <h2>2000+</h2>
            <p>عميل يثق بستوكس</p>
        </div>

        <div class="stat-box">
            <img src="events-icon.png" alt="Events Icon">
            <h2>8000+</h2>
            <p>الفعاليات التي تم تنظيمها</p>
        </div>

        <div class="stat-box">
            <img src="tickets-icon.png" alt="Tickets Icon">
            <h2>400,000+</h2>
            <p>عدد التذاكر المباعة</p>
        </div>
    </div>

    <a href="#" class="contact-btn">تواصل معنا</a>
</section>



@* <div class="title-with-lines mb-5">
    <div class="line"></div>
    <MudText Typo="Typo.h5" Color="Color.Primary" Align="Align.Center" Class="mt-5">@Resource.Rates</MudText>
    <div class="line"></div>
</div>
<section class="mb-4">
    <MudContainer>
        <MudGrid>
            <MudItem xs="12" md="4" Class="ps-md-5">
                <PieChartComponent FillPercentage="70" ChartLabel="Users" InnerValue="50000" />

            </MudItem>
            <MudItem xs="12" md="4" Class="ps-md-5">
                <PieChartComponent FillPercentage="60" ChartLabel="Sold Tickets" InnerValue="10000" />

            </MudItem>
            <MudItem xs="12" md="4" Class="ps-md-5">
                <PieChartComponent FillPercentage="85" ChartLabel="Matches" InnerValue="5000" />
            </MudItem>
        </MudGrid>
    </MudContainer>
</section>

 *@
@code {
    private bool arrows = true;
    private bool bullets = false;
    private bool enableSwipeGesture = true;
    private bool autocycle = true;
    private Transition transition = Transition.Slide;
    private List<MatchDto> ActiveMatches = new();
    private bool IsCarouselShown { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await LoadActiveMatchesAsync();
    }

    private async Task LoadActiveMatchesAsync()
    {
        try
        {
            var response = await MatchService.GetActiveMatches(false);
            _ = response.Match(
                succ =>
                {
                    ActiveMatches = succ.Data?.ToList() ?? [];
                    if (ActiveMatches.Count > 4)
                    {
                        IsCarouselShown = true;
                    }

                    if (!succ.IsSuccess)
                    {
                        Snackbar.Show(Resource.Match_Load_Fail, Severity.Error);
                    }
                    Snackbar.Show(succ.Title!, succ.IsSuccess ? Severity.Info : Severity.Error);
                    succ.ErrorList?.ToList().ForEach(x => Snackbar.Show($"{x.Title}: {x.Message}", Severity.Error));
                    return new Unit();
                },
                fail =>
                {
                    ActiveMatches ??= [];
                    Snackbar.Show(Resource.Error_Occurred, Severity.Error);
                    return new Unit();
                }
            );
        }
        catch (Exception ex)
        {
            Snackbar.Show(Resource.Error_Occurred, Severity.Error);
            Console.WriteLine($"Error during LoadActiveMatchesAsync: {ex.Message}");
        }
    }

    private void NavigateToDetails(Guid matchId)
    {
        NavigationManager.NavigateTo($"/match-details/{matchId}");
    }
}
